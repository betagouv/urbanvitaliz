!function(){"use strict";function t(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(204!==t.status&&205!==t.status)return t.json()}function e(){}function n(t){return t()}function o(){return Object.create(null)}function r(t){t.forEach(n)}function i(t){return"function"==typeof t}function l(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(t,e){t.appendChild(e)}function s(t,e,n){t.insertBefore(e,n||null)}function a(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function f(t){return document.createTextNode(t)}function d(){return f(" ")}function m(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function p(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function h(t,e){t.value=null==e?"":e}let g;function b(t){g=t}function $(){const t=function(){if(!g)throw new Error("Function called outside component initialization");return g}();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const r=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);o.slice().forEach(e=>{e.call(t,r)})}}}const v=[],_=[],y=[],w=[],x=Promise.resolve();let E=!1;function k(t){y.push(t)}let C=!1;const A=new Set;function S(){if(!C){C=!0;do{for(let t=0;t<v.length;t+=1){const e=v[t];b(e),T(e.$$)}for(b(null),v.length=0;_.length;)_.pop()();for(let t=0;t<y.length;t+=1){const e=y[t];A.has(e)||(A.add(e),e())}y.length=0}while(v.length);for(;w.length;)w.pop()();E=!1,C=!1,A.clear()}}function T(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(k)}}const N=new Set;function O(t,e){-1===t.$$.dirty[0]&&(v.push(t),E||(E=!0,x.then(S)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function M(t,l,c,s,u,f,d=[-1]){const m=g;b(t);const p=t.$$={fragment:null,ctx:null,props:f,update:e,not_equal:u,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(m?m.$$.context:[]),callbacks:o(),dirty:d,skip_bound:!1};let h=!1;if(p.ctx=c?c(t,l.props||{},(e,n,...o)=>{const r=o.length?o[0]:n;return p.ctx&&u(p.ctx[e],p.ctx[e]=r)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](r),h&&O(t,e)),n}):[],p.update(),h=!0,r(p.before_update),p.fragment=!!s&&s(p.ctx),l.target){if(l.hydrate){const t=function(t){return Array.from(t.childNodes)}(l.target);p.fragment&&p.fragment.l(t),t.forEach(a)}else p.fragment&&p.fragment.c();l.intro&&(($=t.$$.fragment)&&$.i&&(N.delete($),$.i(v))),function(t,e,o,l){const{fragment:c,on_mount:s,on_destroy:a,after_update:u}=t.$$;c&&c.m(e,o),l||k(()=>{const e=s.map(n).filter(i);a?a.push(...e):r(e),t.$$.on_mount=[]}),u.forEach(k)}(t,l.target,l.anchor,l.customElement),S()}var $,v;b(m)}function j(t){let e,n,o=t[0].emails[0]+"";return{c(){e=u("strong"),n=f(o),p(e,"class","rf-fi-account-fill rf-btn--icon-left")},m(t,o){s(t,e,o),c(e,n)},p(t,e){1&e&&o!==(o=t[0].emails[0]+"")&&function(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}(n,o)},d(t){t&&a(e)}}}function z(t){let n;return{c(){n=u("a"),n.textContent="Se connecter",p(n,"href","https://urbanvitaliz.fr/login/"),p(n,"class","rf-btn rf-fi-account-fill rf-btn--icon-left"),p(n,"aria-expanded","false")},m(t,e){s(t,n,e)},p:e,d(t){t&&a(n)}}}function F(t){let n,o,i,l,f,g,b,$,v,_,y,w,x,E,k,C,A,S,T;function N(t,e){return void 0===t[0]?z:j}let O=N(t),M=O(t);return{c(){M.c(),n=d(),o=u("dialog"),i=u("div"),l=u("div"),f=u("div"),g=u("div"),b=u("form"),$=u("div"),$.innerHTML='<button type="button" class="rf-link--close rf-link svelte-14wsiwu" title="Fermer la fenÃªtre modale" aria-controls="rf-modal-login" target="_self">Fermer</button>',v=d(),_=u("div"),y=u("h1"),y.textContent="Se connecter",w=d(),x=u("label"),x.textContent="Email",E=d(),k=u("input"),C=d(),A=u("div"),A.innerHTML='<ul class="rf-btns-group rf-btns-group--inline-lg rf-btns-group--icon-left"><li><button type="submit" class="rf-btn svelte-14wsiwu">Connexion</button></li></ul>',p($,"class","rf-modal__header"),p(y,"id","rf-modal-title-modal-2"),p(y,"class","rf-modal__title"),p(x,"class","rf-label"),p(x,"for","text-input-text"),p(k,"class","rf-input"),p(k,"type","email"),p(k,"placeholder","perrine@commune.fr"),p(k,"autocomplete","email"),p(k,"name","urbanvitaliz-email"),p(_,"class","rf-modal__content svelte-14wsiwu"),p(A,"class","rf-modal__footer"),p(g,"class","rf-modal__body"),p(f,"class","rf-col-12 rf-col-md-6"),p(l,"class","rf-grid-row rf-grid-row--center"),p(i,"class","rf-container--fluid rf-container-md"),p(o,"aria-labelledby","rf-modal-title-modal-2"),p(o,"role","dialog"),p(o,"id","rf-modal-login"),p(o,"class","rf-modal svelte-14wsiwu")},m(e,r){M.m(e,r),s(e,n,r),s(e,o,r),c(o,i),c(i,l),c(l,f),c(f,g),c(g,b),c(b,$),c(b,v),c(b,_),c(_,y),c(_,w),c(_,x),c(_,E),c(_,k),h(k,t[1]),c(b,C),c(b,A),S||(T=[m(k,"input",t[3]),m(b,"submit",t[2])],S=!0)},p(t,[e]){O===(O=N(t))&&M?M.p(t,e):(M.d(1),M=O(t),M&&(M.c(),M.m(n.parentNode,n))),2&e&&k.value!==t[1]&&h(k,t[1])},i:e,o:e,d(t){M.d(t),t&&a(n),t&&a(o),S=!1,r(T)}}}function L(t,e,n){const o=$();let r="",{person:i}=e;return t.$$set=t=>{"person"in t&&n(0,i=t.person)},[i,r,t=>{t.preventDefault(),o("email",r)},function(){r=this.value,n(1,r)}]}class q extends class{$destroy(){!function(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=e}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),M(this,t,L,F,l,{person:0})}}const P="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~".split("");var B=(t=>(e=20)=>{if(!(e>=0&&Number.isFinite(e)))throw new TypeError("Expected a `length` to be a non-negative finite number");return t(e,P)})((t,e)=>{const n=e.length,o=Math.floor(65536/n)*n-1,r=2*Math.ceil(1.1*t);let i="",l=0;for(;l<t;){const c=new Uint16Array(r);crypto.getRandomValues(c);let s=0;for(;s<r&&l<t;){const t=c[s];s+=2,t>o||(i+=e[t%n],l++)}}return i});const H="betagouv.github.io"===location.hostname?"https://app-20420772-6ed7-40ca-978c-f360edf8941c.cleverapps.io":"http://localhost:4999";console.log("API server origin:",H);var I=location.origin.includes("betagouv.github.io")?"/urbanvitaliz":"";console.log("BONJOIR ðŸ¦„ ");!function(e){const n=new q({target:document.querySelector("header .rf-shortcuts__item"),props:{}});n.$on("email",o=>{const r=o.detail,i=B();(function(e,n){return fetch(e,n).then(t)})(`${H}/login-by-email?email=${r}&secret=${i}`,{method:"POST"}).then(({person:t})=>{document.querySelector('dialog#rf-modal-login button[aria-controls="rf-modal-login"].rf-link--close').click(),n.$set({person:t}),e({person:t})}).catch(t=>console.error("error fetch email",t))})}(({person:t})=>{console.log("login succesful",t),location.assign(function(t){const{firstAccessCapability:e}=t;return`${I}/person?secret=${e}`}(t))})}();
//# sourceMappingURL=header-login.rollup.js.map
